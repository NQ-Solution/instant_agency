// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Model (사람 모델)
model Model {
  id            String   @id @default(cuid())
  name          String
  nameKr        String?
  slug          String   @unique
  category      String   // 'women' | 'men' | 'new'
  featured      Boolean  @default(false)
  profileImage  String
  galleryImages String[] @default([])
  stats         Json     // { height, bust, waist, hips, shoes, eyes, hair }
  location      String   @default("Seoul")
  bio           String?
  experience    Json     @default("[]") // [{ brand, year, type }]
  social        Json     @default("{}") // { instagram, portfolioPdf }
  active        Boolean  @default(true)
  order         Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([category, active, order])
  @@index([featured, active])
}

// Creator (크리에이터)
model Creator {
  id        String   @id @default(cuid())
  name      String
  platform  String
  category  String
  image     String
  followers String
  views     String
  featured  Boolean  @default(false)
  order     Int      @default(0)
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([active, order])
  @@index([featured, active])
}

// Booking (예약)
model Booking {
  id        String   @id @default(cuid())
  date      DateTime
  time      String
  endTime   String?
  service   String
  customer  Json     // { name, email, phone, company? }
  status    String   @default("pending") // 'pending' | 'confirmed' | 'cancelled'
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([date, status])
}

// BookingSettings (예약 설정)
model BookingSettings {
  id              String   @id @default(cuid())
  availableTimes  String[] @default(["09:00", "10:00", "11:00", "13:00", "14:00", "15:00", "16:00", "17:00"])
  blockedDates    String[] @default([])
  blockedWeekdays Int[]    @default([])
  minAdvanceHours Int      @default(24)
  maxAdvanceDays  Int      @default(60)
  slotDuration    Int      @default(60)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// Page (페이지 콘텐츠)
model Page {
  id        String   @id @default(cuid())
  pageId    String   @unique // 'home' | 'about' | 'models' | 'studio' | 'live' | 'contact'
  sections  Json     @default("[]") // [{ sectionId, title, subtitle, description, items, order }]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Settings (설정)
model Settings {
  id             String   @id @default(cuid())
  site           Json     @default("{}") // { name, logo, tagline }
  contact        Json     @default("{}") // { email, phone, businessHours }
  business       Json     @default("{}") // { businessNumber, businessName, representative, businessAddress, ecommerceNumber, hostingProvider }
  pageVisibility Json     @default("{}") // { home, about, models, studio, live, contact } - true = visible, false = hidden
  offices        Json     @default("[]") // [{ city, address }]
  social         Json     @default("{}") // { instagram, linkedin, twitter, youtube }
  partners       String[] @default([])
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

// Image (이미지 저장 - DB에 Base64로 저장)
model Image {
  id        String   @id @default(cuid())
  filename  String
  mimeType  String
  data      String   @db.Text // Base64 encoded
  folder    String   @default("uploads")
  createdAt DateTime @default(now())

  @@index([folder])
}

// Inquiry (문의)
model Inquiry {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  company   String?
  subject   String
  message   String   @db.Text
  status    String   @default("pending") // 'pending' | 'read' | 'replied'
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status, createdAt])
}

// LiveVideo (라이브 비디오)
model LiveVideo {
  id        String   @id @default(cuid())
  tag       String
  title     String
  creator   String
  videoUrl  String
  label     String
  infoTitle String
  desc      String
  stats     Json     @default("{}") // { views, conversion }
  order     Int      @default(0)
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Backup (압축 백업 - 최대 3개 유지)
model Backup {
  id          String   @id @default(cuid())
  name        String   // 백업 이름 (예: "2025-01-09 자동백업")
  description String?  // 백업 설명
  data        String   @db.Text // gzip 압축 후 base64 인코딩된 데이터
  size        Int      // 원본 크기 (bytes)
  compressedSize Int   // 압축 후 크기 (bytes)
  includesImages Boolean @default(false)
  createdAt   DateTime @default(now())

  @@index([createdAt])
}
